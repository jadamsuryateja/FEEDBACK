<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FEEDBACK PORTAL</title>
  <link rel="shortcut icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSU6S6_O-nyrsDfvosOFqEbKjeTBReHLvOQGg&s" type="image/x-icon">

  <style>
    
    .logo {
  align-items: center;
  justify-content: center;
  display: flex;
  margin: 10px;
}

.logo img {
  width: 900px;
  height: auto;
  max-width: 100%;
}

.comments-container {
  display: flex;
  justify-content: space-between;
  gap: 20px;
  margin-top: 20px;
}

.comment-section {
  background: linear-gradient(
    135deg, 
    #16539f 0%, 
    #000000 100%
  );
  border-radius: 8px;
  padding: 15px;
  width: 50%;
  text-align: center;
}

.comment-section textarea {
  width: 90%;
  min-height: 80px;
  margin-top: 10px;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  resize: vertical;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 0.9em;
}

.comment-section label {
  font-weight: bold;
  color: #e5e8eb;
}

/* Rating note styles */
.rating-note {
  position: sticky;
  top: 0;
  background: linear-gradient(135deg, #16539f 0%, #000000 100%);
  padding: 10px;
  z-index: 1000;
  width: 100%;
  box-sizing: border-box;
  margin: 0;
  text-align: center;
  color: white;
  font-weight: bold;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(
    135deg, 
    #16539f 0%, 
    #000000 100%
  );
  margin: 0;
  padding: 0;
  line-height: 1.6;
  position: relative;
  overflow-x: hidden;
}

p1 {
  color: white;
  top: 0;
  position: sticky;
  z-index: 11;
  background-color: #000000;
}

.span {
  color: red;
}

.container {
  width: 90%;
  max-width: 1200px;
  margin: 30px auto;
  padding: 50px 20px 20px 20px; /* Increased top padding for sticky note */
  box-sizing: border-box;
  position: relative;
  z-index: 10;
  background: rgba(255, 255, 255, 0);
  backdrop-filter: blur(1px);
  border-radius: 15px;
  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0);
}

.container:hover {
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

h2, h3 {
  text-align: center;
  color: #2c3e50;
  margin-bottom: 20px;
}

h2 {
  font-size: 2.2em;
  color: #ebf5ff;
}

h3 {
  font-size: 1.8em;
  color: #e7ebee;
}

.info-section {
  background-color: #f9f9f9;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 25px;
  text-align: center;
  display: flex;
  justify-content: center;
  gap: 20px;
}

.info-section p {
  margin: 0;
  color: #11038a;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 25px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

table, th, td {
  border: 1px solid #e0e0e0;
  text-align: center;
  padding: 12px;
}
td{
  text-align: left;
}

th {
  background-color: #3498db;
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  position: sticky;
  top: 40px; /* Adjusted for rating note */
  z-index: 900;
  box-shadow: 0 2px 4px rgb(247, 245, 245);
}

td {
  width: 150px;
  background-color: #f8f9fa;
  transition: background-color 0.3s ease;
}

td:hover {
  background-color: #e9ecef;
}

.rating-radio {
  display: flex;
  align-items: center;
  margin: 5px 0;
  width: 100%;
  justify-content: center;
}

.radio-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

.radio-buttons input[type="radio"] {
  margin-right: 8px;
}

.btn-container {
  text-align: center;
  margin-top: 30px;
}

button {
  padding: 12px 25px;
  background-color: #2ecc71;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1em;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
  position: relative;
  overflow: hidden;
}

button:hover {
  background-color: #27ae60;
  transform: scale(1.05);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: all 0.5s;
}

button:hover::before {
  left: 100%;
}

.step-indicator {
  display: flex;
  justify-content: center;
  margin: 20px 0;
  gap: 10px;
}

.step {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

.step.active {
  background-color: #3498db;
}

.step.completed {
  background-color: #2ecc71;
}

.form-section {
  display: none;
  margin-top: 20px;
}

.form-section.active {
  display: block;
}

/* Validation styles */
.highlight-missing td {
  background-color: #ffebee !important;
  transition: background-color 0.3s ease;
}

.radio-buttons.highlight-missing {
  border: 2px solid #ff0000;
  border-radius: 5px;
  padding: 3px;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.shake {
  animation: shake 0.4s ease-in-out;
}

/* Media Queries */
@media screen and (max-width: 768px) {
  .container {
    width: 95%;
    padding: 10px;
    margin: 15px auto;
    box-sizing: border-box;
  }

  .comments-container {
    flex-direction: column;
    gap: 15px;
  }

  .comment-section {
    width: 95%;
    padding: 10px;
  }

  .comment-section textarea {
    min-height: 60px;
  }

  h2 {
    font-size: 1.8em;
  }

  h3 {
    font-size: 1.5em;
  }

  .info-section {
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 10px;
  }

  .info-section p {
    text-align: center;
    margin: 5px 0;
  }

  table {
    width: 100%;
    font-size: 0.7em;
    border-collapse: collapse;
    
  }

  table th, table td {
    padding: 6px;
    word-wrap: break-word;
    max-width: 100px;
  }

  .radio-buttons {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    gap: 3px;
    
  }

  .rating-radio {
    align-items: center;
    margin: 2px;
  }

  .rating-radio input {
    margin: 0 2px;
  }

  button {
    width: 90%;
    padding: 10px 15px;
    font-size: 0.9em;
  }

  .container {
    overflow-x: auto;
  }

  #feedback-table-container {
    max-width: 100%;
    overflow-x: auto;
  }
}

@media screen and (max-width: 480px) {
  .container {
    width: 100%;
    margin: 5px 0;
    padding: 5px;
  }

  h2 {
    font-size: 1.6em;
  }

  h3 {
    font-size: 1.3em;
  }

  table {
    font-size: 0.6em;
  }

  table th, table td {
    padding: 4px;
    max-width: 80px;
  }

  .radio-buttons {
    gap: 3px;
  }

  .info-section p {
    font-size: 0.9em;
  }
}
</style>


</head>
<body>
<div class="container">
<div class="logo">
  <img src="logo.png" width="900px">
</div>
<h2>Feedback Form</h2>

<div class="step-indicator">
  <div class="step active" data-step="1">1</div>
  <div class="step" data-step="2">2</div>
  <div class="step" data-step="3">3</div>
</div>

<div class="info-section">
  <p><strong>Year:</strong> <span id="year-info"></span></p>
  <p><strong>Semester:</strong> <span id="semester-info"></span></p>
  <p><strong>Branch:</strong> <span id="branch-info"></span></p>
  <p><strong>Section:</strong> <span id="section-info"></span></p>
  <p><strong>Academic Year:</strong> <span id="academicYear-info"></span></p>
</div>

<!-- Theory Subjects Section -->
<div class="form-section active" id="theory-section">
  <h3>Theory Subjects Feedback</h3>
  <div class="rating-note">
    <span class="span">NOTE: </span> 1: POOR | 2: AVERAGE | 3: SATISFACTORY | 4: GOOD | 5: EXCELLENT
  </div>  <div id="theory-feedback-container"></div>
  <div class="btn-container">
    <button type="button" id="next-to-lab">Next</button>
  </div>
</div>

<!-- Lab Subjects Section -->
<div class="form-section" id="lab-section">
  <h3>Lab Subjects Feedback</h3>
  <div class="rating-note">
    <span class="span">NOTE: </span> 1: POOR | 2: AVERAGE | 3: SATISFACTORY | 4: GOOD | 5: EXCELLENT
  </div>  <div id="lab-feedback-container"></div>
  <div class="btn-container">
    <button type="button" id="next-to-comments">Next</button>
  </div>
</div>

<!-- Comments Section -->
<div class="form-section" id="comments-section">
  <h3>Additional Comments</h3>
  <div class="comments-container">
    <div class="comment-section">
      <label for="teacher-comments">Comments about College:</label>
      <textarea id="teacher-comments" placeholder="Enter your comments..."></textarea>
    </div>

    <div class="comment-section">
      <label for="department-comments">Comments about Department:</label>
      <textarea id="department-comments" placeholder="Enter your comments..."></textarea>
    </div>
  </div>
  <div class="btn-container">
    <button type="button" id="submit-feedback">Submit Feedback</button>
  </div>
</div>
</div>

<div id="particles-js"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>


<script>
  // Add validation styles
const newStyles = `
.highlight-missing td {
  background-color: #ffebee !important;
  transition: background-color 0.3s ease;
}

.radio-buttons.highlight-missing {
  border: 2px solid #ff0000;
  border-radius: 5px;
  padding: 3px;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.shake {
  animation: shake 0.4s ease-in-out;
}`;

const styleSheet = document.createElement("style");
styleSheet.textContent = newStyles;
document.head.appendChild(styleSheet);

// Get URL parameters
const urlParams = new URLSearchParams(window.location.search);
const year = urlParams.get("year");
const semester = urlParams.get("semester");
const branch = urlParams.get("branch");
const section = urlParams.get("section");
const academicYear = urlParams.get("academicYear");
const theoryTeachers = JSON.parse(urlParams.get("theoryTeachers"));
const labTeachers = JSON.parse(urlParams.get("labTeachers"));

// Set info section values
document.getElementById("year-info").textContent = year || 'N/A';
document.getElementById("semester-info").textContent = semester || 'N/A';
document.getElementById("branch-info").textContent = branch || 'N/A';
document.getElementById("section-info").textContent = section || 'N/A';
document.getElementById("academicYear-info").textContent = academicYear || 'N/A';

const questions = [
  "Teacher's Knowledge base in respect of the subject taught?",
  "Communication Skills in terms of explaining concepts, theories etc",
  "Teacher make use of examples/ completion of course syllabus as scheduled.",
  "Encouraging students in asking questions and clearing their doubts satisfactorily",
  "Class management- interaction with students (Motivation)",
  "Self discipline/Punctuality/Individual behavior of teacher",
  "Use of Powerpoint presentation/ ICT tools",
  "Board usage/ Subject notes",
  "Voice is louder and clear",
  "Overall rating of the teacher"
];

// Function to create feedback table
function createFeedbackTable(container, teachersList) {
  const table = document.createElement("table");
  table.innerHTML = `
    <tr>
      <th>Questions</th>
      ${teachersList.map(pair => `<th>${pair.teacher}<br>${pair.subject}</th>`).join('')}
    </tr>
  `;

  questions.forEach((question, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${index + 1}. ${question}</td>
      ${teachersList.map(pair => `
        <td>
          <div class="radio-buttons">
            ${['1','2','3','4','5'].map((label, i) => `
              <label class="rating-radio">
                <input type="radio" name="rating-${pair.teacher}-${pair.subject}-${index}" value="${6+i}">
                ${label}
              </label>
            `).join('')}
          </div>
        </td>
      `).join('')}
    `;
    table.appendChild(row);
  });

  container.appendChild(table);
}

// Create theory and lab feedback tables
createFeedbackTable(document.getElementById("theory-feedback-container"), theoryTeachers);
createFeedbackTable(document.getElementById("lab-feedback-container"), labTeachers);

// Navigation functions
function showSection(sectionId) {
  document.querySelectorAll('.form-section').forEach(section => {
    section.classList.remove('active');
  });
  document.getElementById(sectionId).classList.add('active');
  
  // Update step indicators
  const stepNumber = {
    'theory-section': 1,
    'lab-section': 2,
    'comments-section': 3
  }[sectionId];
  
  document.querySelectorAll('.step').forEach(step => {
    const stepData = parseInt(step.dataset.step);
    step.classList.remove('active', 'completed');
    if (stepData === stepNumber) {
      step.classList.add('active');
    } else if (stepData < stepNumber) {
      step.classList.add('completed');
    }
  });
}

// Enhanced validation function
function validateSection(teachersList) {
  let allSelected = true;
  const rows = document.querySelectorAll('tr');
  
  // First, remove all previous highlighting
  rows.forEach(row => {
    row.classList.remove('highlight-missing');
  });
  document.querySelectorAll('.radio-buttons').forEach(div => {
    div.classList.remove('highlight-missing');
  });

  teachersList.forEach(pair => {
    questions.forEach((_, index) => {
      const rating = document.querySelector(
        `input[name="rating-${pair.teacher}-${pair.subject}-${index}"]:checked`
      );
      
      if (!rating) {
        allSelected = false;
        // Find and highlight the specific row and radio buttons group
        const inputGroup = document.querySelector(
          `input[name="rating-${pair.teacher}-${pair.subject}-${index}"]`
        ).closest('.radio-buttons');
        const row = inputGroup.closest('tr');
        
        row.classList.add('highlight-missing');
        inputGroup.classList.add('highlight-missing');
        row.classList.add('shake');
        
        // Remove shake animation after it completes
        setTimeout(() => {
          row.classList.remove('shake');
        }, 400);
      }
    });
  });

  // Scroll to the first missing answer if any
  if (!allSelected) {
    const firstMissing = document.querySelector('.highlight-missing');
    if (firstMissing) {
      firstMissing.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }

  return allSelected;
}

// Button event listeners
document.getElementById("next-to-lab").addEventListener("click", () => {
  if (validateSection(theoryTeachers)) {
    showSection('lab-section');
  } else {
    alert("Please complete all ratings for theory subjects.");
  }
});

document.getElementById("next-to-comments").addEventListener("click", () => {
  if (validateSection(labTeachers)) {
    showSection('comments-section');
  } else {
    alert("Please complete all ratings for lab subjects.");
  }
});

// Remove highlighting when user selects an option
document.addEventListener('change', (e) => {
  if (e.target.type === 'radio') {
    const row = e.target.closest('tr');
    const radioButtons = e.target.closest('.radio-buttons');
    if (row) row.classList.remove('highlight-missing');
    if (radioButtons) radioButtons.classList.remove('highlight-missing');
  }
});

// Submit feedback handler
document.getElementById("submit-feedback").addEventListener("click", () => {
  const feedbackData = [];
  const collegeComments = document.getElementById("teacher-comments").value;
  const departmentComments = document.getElementById("department-comments").value;

  // Collect theory feedback
  theoryTeachers.forEach(pair => {
    questions.forEach((_, index) => {
      const rating = document.querySelector(
        `input[name="rating-${pair.teacher}-${pair.subject}-${index}"]:checked`
      );
      if (rating) {
        feedbackData.push({
          teacher: pair.teacher,
          subject: pair.subject,
          question_id: index + 1,
          rating: parseInt(rating.value),
          type: 'theory'
        });
      }
    });
  });

  // Collect lab feedback
  labTeachers.forEach(pair => {
    questions.forEach((_, index) => {
      const rating = document.querySelector(
        `input[name="rating-${pair.teacher}-${pair.subject}-${index}"]:checked`
      );
      if (rating) {
        feedbackData.push({
          teacher: pair.teacher,
          subject: pair.subject,
          question_id: index + 1,
          rating: parseInt(rating.value),
          type: 'lab'
        });
      }
    });
  });

  // Submit all feedback data
  fetch('http://192.168.95.97:3000/submit-feedback', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      year,
      semester,
      branch,
      section,
      academicYear,
      feedbackData,
      collegeComments,
      departmentComments
    })
  })
  .then(response => {
    if (!response.ok) throw new Error(`Server error: ${response.statusText}`);
    return response.json();
  })
  .then(data => {
    alert("Feedback successfully submitted!");
    window.location.replace("tq.html");
  })
  .catch(err => {
    console.error("Error during submission:", err);
    alert("Something went wrong. Please try again later.");
  });
});
</script>
</body>
</html>